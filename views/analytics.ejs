<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Urdu Learning</title>
    <script src="/js/ui-preferences.js"></script>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <h2>ğŸ‡µğŸ‡° Urdu Learning App</h2>
        <div class="nav-right">
            <span class="user-name"><%= user.username %></span>
            <a href="/dashboard" class="btn btn-small">Dashboard</a>
            <a href="/logout" class="btn btn-small btn-danger">Logout</a>
        </div>
    </nav>

    <div class="container">
        <h1 style="margin-bottom: 1rem;">ğŸ“ˆ Learning Analytics</h1>
        <p class="muted" style="margin-bottom: 1.5rem;">Vocabulary progressØŒ grammar Ú©ÛŒ Ú©Ù…Ø²ÙˆØ±ÛŒØ§ÚºØŒ Ø§ÙˆØ± Ú©Ú¾ÛŒÙ„ÙˆÚº Ú©ÛŒ Ú©Ø§Ø±Ú©Ø±Ø¯Ú¯ÛŒ Ø§ÛŒÚ© Ø¬Ú¯ÛÛ”</p>

        <div class="dashboard-grid">
            <!-- Left column: vocabulary + grammar -->
            <div>
                <section class="progress-summary" style="margin-bottom: 1.5rem;">
                    <h3>ğŸ“š Vocabulary growth (by lesson)</h3>
                    <p class="muted" style="margin-top: 0.25rem;">ÛØ± lesson Ú©Û’ Ù„Ø¦Û’ Ù…Ø¬Ù…ÙˆØ¹ÛŒ Ø§Ø³Ú©ÙˆØ± (Ùª)Û” Ú¯ÛØ±Ø§ Ø­ØµÛ Ø¨ÛØªØ± Ú©Ø§Ø±Ú©Ø±Ø¯Ú¯ÛŒ Ú©Ùˆ Ø¸Ø§ÛØ± Ú©Ø±ØªØ§ ÛÛ’Û”</p>
                    <div style="margin-top: 0.75rem; display: grid; gap: 0.3rem; max-height: 260px; overflow-y: auto;">
                        <% vocabSeries.forEach(function (row) { %>
                            <div style="display:flex; align-items:center; gap:0.5rem;">
                                <span style="min-width: 60px; font-size: 0.9rem;">L<%= row.levelNumber %></span>
                                <div class="progress-bar" style="flex:1; height: 12px;">
                                    <div class="progress-fill" style="width: <%= row.totalPercent %>%;"></div>
                                </div>
                                <span style="min-width: 40px; text-align:right; font-size:0.8rem;">
                                    <%= row.totalPercent %>%
                                </span>
                            </div>
                        <% }) %>
                    </div>
                </section>

                <section class="progress-summary">
                    <h3>ğŸ“’ Grammar Ú©Ù…Ø²ÙˆØ±ÛŒØ§Úº</h3>
                    <p class="muted" style="margin-top: 0.25rem;">ÙˆÛ grammar topics Ø¬ÛØ§Úº Ø§ÙˆØ³Ø· Ø§Ø³Ú©ÙˆØ± Ú©Ù… ÛÛ’Û” Ù†ÛŒÚ†Û’ Ø³Û’ Ø§ÙˆÙ¾Ø± ØªÚ© Ø¨ÛØªØ± ÛÙˆØªØ§ ÛÛ’Û”</p>
                    <div style="margin-top: 0.75rem; display: grid; gap: 0.4rem; max-height: 260px; overflow-y: auto;">
                        <% if (grammarAreas.length === 0) { %>
                            <p class="muted">Ø§Ø¨Ú¾ÛŒ grammar data Ú©Ø§ÙÛŒ Ù†ÛÛŒÚº ÛÛ’Û”</p>
                        <% } %>
                        <% grammarAreas.forEach(function (g) { %>
                            <div style="display:flex; flex-direction:column; gap:0.15rem;">
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <span><%= g.label %></span>
                                    <span class="muted"><%= g.avg %>%</span>
                                </div>
                                <div class="progress-bar" style="height: 8px;">
                                    <div class="progress-fill" style="width: <%= g.avg %>%;"></div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                </section>
            </div>

            <!-- Right column: games + streak -->
            <div>
                <section class="progress-summary" style="margin-bottom: 1.5rem;">
                    <h3>ğŸ® Game accuracy</h3>
                    <div style="margin-top:0.75rem; display:grid; gap:0.75rem;">
                        <div>
                            <div class="settings-label">Cultural quiz</div>
                            <% const cAttempts = gameStats.culture.attempts || 0; %>
                            <% const cCompleted = gameStats.culture.completed || 0; %>
                            <% const cAcc = cAttempts > 0 ? Math.round((cCompleted / cAttempts) * 100) : 0; %>
                            <p class="muted">Accuracy: <strong><%= cAcc %>%</strong> (completed <%= cCompleted %> / attempts <%= cAttempts %>)</p>
                        </div>

                        <div>
                            <div class="settings-label">Context words</div>
                            <ul class="muted" style="margin-left:1.1rem; margin-top:0.25rem;">
                                <% ['meaning','scenario','duel'].forEach(function (mode) { %>
                                    <% const s = gameStats.context[mode]; %>
                                    <% const a = s.attempts || 0; %>
                                    <% const comp = s.completed || 0; %>
                                    <% const acc = a > 0 ? Math.round((comp / a) * 100) : 0; %>
                                    <li><strong><%= mode %></strong>: <%= acc %>% (completed <%= comp %> / attempts <%= a %>)</li>
                                <% }) %>
                            </ul>
                        </div>

                        <p class="muted" style="font-size:0.85rem;">Ù†ÙˆÙ¹: ÙˆÙ‚Øª Ø®Ø±Ú† (time-on-task) ÙÛŒ Ø§Ù„Ø­Ø§Ù„ Ø¯Ø±Ø³Øª Ø·Ø±ÛŒÙ‚Û’ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ù†ÛÛŒÚº Ú©ÛŒØ§ Ø¬Ø§ Ø±ÛØ§ØŒ Ø§Ø³ Ù„Ø¦Û’ ÛŒÛØ§Úº Ù…Ù†Ù¹ Ù†ÛÛŒÚº Ø¯Ú©Ú¾Ø§Ø¦Û’ Ú¯Ø¦Û’Û”</p>
                    </div>
                </section>

                <section class="progress-summary">
                    <h3>ğŸ”¥ Practice streak</h3>
                    <p class="muted" style="margin-top:0.25rem;">Ù…Ø³Ù„Ø³Ù„ Ø¯Ù† Ø¬Ù† Ù…ÛŒÚº Ø¢Ù¾ Ù†Û’ practice Ú©ÛŒ ÛÛ’Û”</p>
                    <div style="margin-top:0.75rem; display:flex; gap:1.5rem; flex-wrap:wrap;">
                        <div>
                            <div class="settings-label">Current streak</div>
                            <div class="kpi-value"><%= practiceStats.currentStreak || 0 %> days</div>
                        </div>
                        <div>
                            <div class="settings-label">Best streak</div>
                            <div class="kpi-value"><%= practiceStats.bestStreak || 0 %> days</div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script src="/js/profile-modal.js"></script>
</body>
</html>
